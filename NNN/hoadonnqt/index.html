<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form Hóa Đơn Kinh Doanh</title>
    <link rel="stylesheet" href="styles.css">
    <script src="nqt.js" defer></script>
</head>
<body>
    <div class="menu">
        <button class="button" onclick="viewSavedInvoices()">Xem Hóa Đơn Đã Lưu</button>
        <button class="button" onclick="clearSavedInvoices()">Xóa Tất Cả Hóa Đơn Đã Lưu</button>
    </div>

    <div class="container fade-in">
        <div class="header">Form Hóa Đơn</div>
        <div class="content">
            <form id="invoiceForm">
                <div class="form-group">
                    <label for="invoice">Mã số hóa đơn</label>
                    <input type="text" id="invoice" name="invoice" required>
                </div>
                <div class="form-group">
                    <label for="date">Ngày tháng năm</label>
                    <input type="date" id="date" name="date" required>
                </div>
                <div class="form-group">
                    <label for="name">Họ và tên</label>
                    <input type="text" id="name" name="name" required>
                </div>
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" name="email" required>
                </div>
                <div class="form-group">
                    <label for="phone">Số điện thoại</label>
                    <input type="tel" id="phone" name="phone">
                </div>
                <div class="form-group">
                    <label for="address">Địa chỉ</label>
                    <textarea id="address" name="address" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="notes">Ghi chú</label>
                    <textarea id="notes" name="notes" rows="3"></textarea>
                </div>
            </form>

            <h3>Danh sách sản phẩm</h3>
            <ul id="productList">
                <li>
                    <div class="product-input">
                        <input type="text" placeholder="Tên sản phẩm" required>
                        <input type="number" placeholder="Số lượng" min="1" required>
                        <input type="number" placeholder="Giá" min="0" required>
                        <button class="remove-product" onclick="removeProduct(this)">Xóa</button>
                    </div>
                </li>
            </ul>
            <button class="button" onclick="addProduct()">Thêm sản phẩm</button>
            <button type="button" class="button save-invoice" onclick="generateInvoice()">Lưu hóa đơn</button>
            <button type="button" class="button new-invoice" style="background-color: #FF3B30;" onclick="clearForm()">Tạo hóa đơn mới</button>
        </div>
    </div>

    <div id="invoiceContainer" class="container fade-in" style="display: none; margin-top: 20px;">
        <div class="header">Hóa Đơn</div>
        <div class="content">
            <table id="invoiceTable"></table>
            <div class="footer">
                <p>Số điện thoại liên hệ: 0983901996</p>
                <p>Xin cảm ơn quý khách!</p>
            </div>
            <div class="action-buttons">
                <button type="button" class="button" onclick="savePNG()">Lưu PNG</button>
                <button type="button" class="button" onclick="sendEmail()">Gửi Email</button>
            </div>
        </div>
    </div>

    <!-- Modal để hiển thị hóa đơn đã lưu -->
    <div id="savedInvoicesModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="header" style="background-color: #3D9CFF; color: white;">
                <h3>Hóa Đơn Đã Lưu</h3>
            </div>
            <span class="close" onclick="closeModal()" style="cursor: pointer;">&times;</span>
            <ul id="savedInvoicesList"></ul>
            <button class="button" onclick="closeModal()" style="background-color: #FF3B30; margin-top: 20px;">Thoát</button>
        </div>
    </div>

    <script>
        function clearForm() {
            document.getElementById('invoiceForm').reset(); // Reset form
            document.getElementById('productList').innerHTML = `
                <li>
                    <div class="product-input">
                        <input type="text" placeholder="Tên sản phẩm" required>
                        <input type="number" placeholder="Số lượng" min="1" required>
                        <input type="number" placeholder="Giá" min="0" required>
                        <button class="remove-product" onclick="removeProduct(this)">Xóa</button>
                    </div>
                </li>
            `;
            document.getElementById('invoiceContainer').style.display = 'none'; // Ẩn hóa đơn
        }

        function closeModal() {
            document.getElementById('savedInvoicesModal').style.display = 'none'; // Ẩn modal
        }

        function viewSavedInvoices() {
            // Hiển thị hóa đơn đã lưu
            const modal = document.getElementById('savedInvoicesModal');
            modal.style.display = 'flex'; // Hiển thị modal
            const savedInvoicesList = document.getElementById('savedInvoicesList');
            savedInvoicesList.innerHTML = ''; // Reset danh sách

            // Lấy dữ liệu hóa đơn đã lưu từ localStorage
            const invoices = JSON.parse(localStorage.getItem('savedInvoices')) || [];
            invoices.forEach(invoice => {
                const li = document.createElement('li');
                li.textContent = `Mã hóa đơn: ${invoice.invoice}, Ngày: ${invoice.date}, Khách hàng: ${invoice.name}`;
                savedInvoicesList.appendChild(li);
            });
        }

        function clearSavedInvoices() {
            // Xóa tất cả hóa đơn đã lưu
            localStorage.removeItem('savedInvoices');
            alert('Đã xóa tất cả hóa đơn đã lưu.');
        }

        function generateInvoice() {
            // Tạo hóa đơn và hiển thị
            const form = document.getElementById('invoiceForm');
            const invoiceData = {
                invoice: form.invoice.value,
                date: form.date.value,
                name: form.name.value,
                email: form.email.value,
                phone: form.phone.value,
                address: form.address.value,
                notes: form.notes.value,
                products: Array.from(document.querySelectorAll('.product-input')).map(input => ({
                    name: input.querySelector('input[type="text"]').value,
                    quantity: input.querySelector('input[type="number"]:nth-of-type(1)').value,
                    price: input.querySelector('input[type="number"]:nth-of-type(2)').value
                }))
            };

            // Lưu hóa đơn vào localStorage
            const savedInvoices = JSON.parse(localStorage.getItem('savedInvoices')) || [];
            savedInvoices.push(invoiceData);
            localStorage.setItem('savedInvoices', JSON.stringify(savedInvoices));

            // Hiển thị hóa đơn
            displayInvoice(invoiceData);
        }

        function displayInvoice(invoiceData) {
            const invoiceContainer = document.getElementById('invoiceContainer');
            const invoiceTable = document.getElementById('invoiceTable');

            // Tạo nội dung cho hóa đơn
            invoiceTable.innerHTML = `
                <tr>
                    <th>Mã số hóa đơn</th>
                    <td>${invoiceData.invoice}</td>
                </tr>
                <tr>
                    <th>Ngày tháng năm</th>
                    <td>${invoiceData.date}</td>
                </tr>
                <tr>
                    <th>Họ và tên</th>
                    <td>${invoiceData.name}</td>
                </tr>
                <tr>
                    <th>Email</th>
                    <td>${invoiceData.email}</td>
                </tr>
                <tr>
                    <th>Số điện thoại</th>
                    <td>${invoiceData.phone}</td>
                </tr>
                <tr>
                    <th>Địa chỉ</th>
                    <td>${invoiceData.address}</td>
                </tr>
                <tr>
                    <th>Ghi chú</th>
                    <td>${invoiceData.notes}</td>
                </tr>
                <tr>
                    <th>Sản phẩm</th>
                    <td>
                        <ul>
                            ${invoiceData.products.map(product => `<li>${product.name} - Số lượng: ${product.quantity} - Giá: ${product.price}</li>`).join('')}
                        </ul>
                    </td>
                </tr>
            `;

            invoiceContainer.style.display = 'block'; // Hiển thị hóa đơn
        }

        function removeProduct(button) {
            // Xóa sản phẩm từ danh sách
            button.parentElement.parentElement.remove();
        }

        function addProduct() {
            // Thêm sản phẩm mới vào danh sách
            const newProductHTML = `
                <li>
                    <div class="product-input">
                        <input type="text" placeholder="Tên sản phẩm" required>
                        <input type="number" placeholder="Số lượng" min="1" required>
                        <input type="number" placeholder="Giá" min="0" required>
                        <button class="remove-product" onclick="removeProduct(this)">Xóa</button>
                    </div>
                </li>
            `;
            document.getElementById('productList').insertAdjacentHTML('beforeend', newProductHTML);
        }

        function savePNG() {
            // Hàm lưu hóa đơn dưới dạng PNG (chưa được triển khai trong ví dụ này)
            alert("Chức năng này vẫn đang được phát triển!");
        }

        function sendEmail() {
            // Hàm gửi email (chưa được triển khai trong ví dụ này)
            alert("Chức năng này vẫn đang được phát triển!");
        }
    </script>
</body>
</html>
